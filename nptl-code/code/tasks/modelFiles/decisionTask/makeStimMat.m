function stimMat = makeStimMat(cohD)
% make stimCondsMat for desired coherence levels cohD
% the actual coherence will vary to make the num red squares an integer
% num squares total is hardcoded to be 15*15; 
% col 1: 2 = L/R, 1 = U/D
% col 2: color of Left/Down targ 2 = red, 3 = green
% col 3: color of right/up targ 2 = red, 3 = green
% col 4: number of red squares (out of 225)
% col 5: which target is correct. 1 = left/down, 2 = right/up
maxSquares = 15*15; 
numR = zeros(1,length(cohD)); 
cohDcount = 0;
for cidx = cohD 
    cohDcount = cohDcount + 1; 
    numR(cohDcount) = round(((maxSquares*cidx/100)+maxSquares)/2);
end

numR = [numR, (maxSquares - numR)];

col1T = ones(cohDcount*8,1);    % size = numCoh * numAxes * numColors * numTargs
col1T(cohDcount*4+1:end,1) = 2; % target axis index
col23T = [[ones(cohDcount*2,1); ones(cohDcount*2,1)+1]+1, [ones(cohDcount*2,1)+1; ones(cohDcount*2,1)]+1];
col4T = sort(numR, 'descend')'; 
col5T = [ones(cohDcount,1); ones(cohDcount,1)+1; ones(cohDcount,1)+1; ones(cohDcount,1)];
stimMat = [col1T, repmat(col23T, 2,1), repmat(col4T, 4,1), repmat(col5T, 2,1)];  

% %% For reference, the hard-coded version with 7 coherence
% coh = approx(4 10 20 31 40 60 90.2)
% StimCondMat = uint16([
%     1 2 3 214 1;...
%     1 2 3 180 1;...
%     1 2 3 158 1;...
%     1 2 3 147 1;...
%     1 2 3 135 1;...
%     1 2 3 124 1;...
%     1 2 3 117 1;...
%     1 2 3 108 2;...
%     1 2 3 101 2;...
%     1 2 3 90  2;...
%     1 2 3 78  2;...
%     1 2 3 67  2;...
%     1 2 3 45  2;...
%     1 2 3 11  2;
%     1 3 2 214 2;...
%     1 3 2 180 2;...
%     1 3 2 158 2;...
%     1 3 2 147 2;...
%     1 3 2 135 2;...
%     1 3 2 124 2;...
%     1 3 2 117 2;...
%     1 3 2 108 1;...
%     1 3 2 101 1;...
%     1 3 2  90 1;...
%     1 3 2  78 1;...
%     1 3 2  67 1;...
%     1 3 2  45 1;...
%     1 3 2  11 1;...
%     2 2 3 214 1;...
%     2 2 3 180 1;...
%     2 2 3 158 1;...
%     2 2 3 147 1;...
%     2 2 3 135 1;...
%     2 2 3 124 1;...
%     2 2 3 117 1;...
%     2 2 3 108 2;...
%     2 2 3 101 2;...
%     2 2 3 90  2;...
%     2 2 3 78  2;...
%     2 2 3 67  2;...
%     2 2 3 45  2;...
%     2 2 3 11  2;
%     2 3 2 214 2;...
%     2 3 2 180 2;...
%     2 3 2 158 2;...
%     2 3 2 147 2;...
%     2 3 2 135 2;...
%     2 3 2 124 2;...
%     2 3 2 117 2;...
%     2 3 2 108 1;...
%     2 3 2 101 1;...
%     2 3 2  90 1;...
%     2 3 2  78 1;...
%     2 3 2  67 1;...
%     2 3 2  45 1;...
%     2 3 2  11 1;...
%     ]);